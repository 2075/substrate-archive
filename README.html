<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Substrate Archive</title>
        <style>
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        <link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </head>
    <body class="vscode-light">
        <div align="center">
# Substrate Archive
<p><a href="#install">Install the CLI</a> • <a href="https://github.com/paritytech/substrate-archive/wiki">Documentation</a> • <a href="#contributing">Contributing</a></p>
</div>
Run this alongside the substrate client to sync all historical TxData. Indexes all Blocks, State, and Extrinsic date from a running node.
<p>Example Usage:</p>
<pre><code class="language-rust"><div><span class="hljs-keyword">use</span> polkadot_service::{kusama_runtime <span class="hljs-keyword">as</span> ksm_runtime, Block};
<span class="hljs-keyword">use</span> substrate_archive::{backend, init, chain_traits::{HeaderBackend <span class="hljs-keyword">as</span> _}, twox_128, StorageKey};

<span class="hljs-keyword">pub</span> <span class="hljs-function"><span class="hljs-keyword">fn</span> <span class="hljs-title">main</span></span>() {
    <span class="hljs-keyword">let</span> db =
        backend::open_database::&lt;Block&gt;(<span class="hljs-string">"/home/insipx/.local/share/polkadot/chains/ksmcc4/db"</span>, <span class="hljs-number">8192</span>).unwrap();

    <span class="hljs-keyword">let</span> spec = polkadot_service::chain_spec::kusama_config().unwrap();
    <span class="hljs-keyword">let</span> client =
        backend::client::&lt;Block, ksm_runtime::RuntimeApi, polkadot_service::KusamaExecutor, _&gt;(
            db, spec,
        )
        .unwrap();

    <span class="hljs-keyword">let</span> info = client.info();
    <span class="hljs-built_in">println!</span>(<span class="hljs-string">"{:?}"</span>, info);

    <span class="hljs-comment">// create the keys we want to query storage for</span>
    <span class="hljs-keyword">let</span> system_key = twox_128(<span class="hljs-string">b"System"</span>).to_vec();
    <span class="hljs-keyword">let</span> accounts_key = twox_128(<span class="hljs-string">b"Account"</span>).to_vec();

    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> keys = <span class="hljs-built_in">Vec</span>::new();
   
    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut</span> system_accounts = system_key.clone();
    system_accounts.extend(accounts_key);
    
    keys.push(StorageKey(system_accounts));
   
    <span class="hljs-comment">// run until we want to exit (Ctrl-C)</span>
    futures::executor::block_on(init::&lt;ksm_runtime::Runtime, _&gt;(
        client,
        <span class="hljs-string">"ws://127.0.0.1:9944"</span>.to_string(),
        keys,
    ))
    .unwrap()
}
</div></code></pre>
<p>more fleshed-out example can be found in <code>archive/examples/simple.rs</code>. You can run it by entering the <code>archive</code> directory
and running <code>cargo run --example simple --features logging</code></p>
<p>The schema for the PostgreSQL database is described in the PDF File at the root of this directory</p>
<h3 id="requirements">Requirements</h3>
<p>Extended requirements list found in the <a href="https://github.com/paritytech/substrate-archive/wiki/Requirements">wiki</a></p>
<ul>
<li>PostgreSQL</li>
<li>Substrate-based Blockchain running with Rocksdb as the backend</li>
</ul>
<h3 id="how-to-use">How to use</h3>
<ul>
<li>need a Postgres Database with the URL exposed as an environment variable under the name <code>DATABASE_URL</code></li>
<li>Create the tables by running <code>./schema/archive.sql</code> inside Postgres</li>
</ul>
<p>Create the database</p>
<pre><code><code><div>sudo -u postgres createdb -O $(whoami) archive
psql -d postgres://$(whoami):password@localhost/archive -f ./schema/archive.sql
</div></code></code></pre>
<h5 id="required-dependencies">Required Dependencies:</h5>
<p>Ubuntu: <code>postgresql</code>, <code>postgresql-contrib</code>, <code>libpq-dev</code>
Fedora: <code>postgresql</code>, <code>postgresql-contrib</code>, <code>postgresql-devel</code></p>

    </body>
    </html>